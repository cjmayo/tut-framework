<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>TUT: C++ Template Unit Test Framework</title>
    <link rel="shortcut icon" href="tut.ico" />
    <meta charset='utf-8'>
    <meta name="keywords" content="C++ Unit Test Simple" />
    <meta name="description" content="TUT: C++ Template Unit Test Framework" />
    <meta name="generator" content="webgen - http://webgen.rubyforge.com/" />
    <link href="default.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <a href="https://github.com/mrzechonek/tut-framework"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
    <div id="header">
      <h1>
        <a href="http://tut-framework.sourceforge.net/"><img src="tut.png" alt="tut logo"/></a>
        C++ Template Unit Test Framework
      </h1>
    </div>

    <div id="menu">
        <ul><li class="webgen-menu-level1"><a href="index.html" hreflang="en">Introduction</a></li><li class="webgen-menu-level1"><a href="news.html" hreflang="en">News</a></li><li class="webgen-menu-level1"><a href="download.html" hreflang="en">Download</a></li><li class="webgen-menu-level1 webgen-menu-item-selected"><a href="example.html" hreflang="en">Example</a></li><li class="webgen-menu-level1"><a href="howto.html" hreflang="en">How To</a></li><li class="webgen-menu-level1"><a href="faq.html" hreflang="en">FAQ</a></li><li class="webgen-menu-level1"><a href="authors.html" hreflang="en">Authors</a></li><li class="webgen-menu-level1"><a href="links.html" hreflang="en">Links</a></li><li class="webgen-menu-level1"><a href="copyright.html" hreflang="en">Copyright</a></li><li class="webgen-menu-level1"><a href="https://github.com/mrzechonek/tut-framework/issues">Issues</a></li><li class="webgen-menu-level1"><a href="doxygen/index.html">Reference Manual</a></li></ul>
    </div>

    <div id="body">
        <h1><span>it's better to see once...</span>Example </h1>
        
<p>An example testgroup which tests a std::auto_ptr implementation. Of course, those tests are far from complete.</p>

<div class="CodeRay">
  <div class="code"><pre>
<span style="color:#579">#include</span> <span style="color:#B44;font-weight:bold">&lt;tut/tut.hpp&gt;</span>
<span style="color:#579">#include</span> <span style="color:#B44;font-weight:bold">&lt;memory&gt;</span>

using std::auto_ptr;

<span style="color:#777">/**
 * This example test group tests std::auto_ptr implementation.
 * Tests are far from full, of course.
 */</span>
namespace tut
{
<span style="color:#777">/**
 * Struct which may contain test data members.
 * Test object (class that contains test methods)
 * will inherite from it, so each test method can
 * access members directly.
 *
 * Additionally, for each test, test object is re-created
 * using defaut constructor. Thus, any prepare work can be put
 * into default constructor.
 *
 * Finally, after each test, test object is destroyed independently
 * of test result, so any cleanup work should be located in destructor.
 */</span>
<span style="color:#080;font-weight:bold">struct</span> auto_ptr_data
{
    <span style="color:#777">/**
     * Type used to check scope lifetime of auto_ptr object.
     * Sets extern boolean value into true at constructor, and
     * to false at destructor.
     */</span>
    <span style="color:#0a8;font-weight:bold">bool</span> exists;

    <span style="color:#080;font-weight:bold">struct</span> existing
    {
        <span style="color:#0a8;font-weight:bold">bool</span>&amp; s_;
        existing(<span style="color:#0a8;font-weight:bold">bool</span>&amp; s) : s_(s)
        {
            s_ = <span style="color:#069">true</span>;
        }

        ~existing()
        {
            s_ = <span style="color:#069">false</span>;
        }
    };

    auto_ptr_data(): exists(<span style="color:#069">false</span>) { }

    virtual ~auto_ptr_data() { }
};

<span style="color:#777">/**
 * This group of declarations is just to register
 * test group in test-application-wide singleton.
 * Name of test group object (auto_ptr_group) shall
 * be unique in tut:: namespace. Alternatively, you
 * you may put it into anonymous namespace.
 */</span>
<span style="color:#080;font-weight:bold">typedef</span> test_group&lt;auto_ptr_data&gt; tf;
<span style="color:#080;font-weight:bold">typedef</span> tf::object object;
tf auto_ptr_group(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">std::auto_ptr</span><span style="color:#710">&quot;</span></span>);

<span style="color:#777">/**
 * Checks default constructor.
 */</span>
template&lt;&gt;
template&lt;&gt;
<span style="color:#088;font-weight:bold">void</span> object::test&lt;<span style="color:#00D">1</span>&gt;()
{
    auto_ptr&lt;existing&gt; ap;
    ensure(ap.get() == <span style="color:#00D">0</span>);
    ensure(ap.operator-&gt;() == <span style="color:#00D">0</span>);
}

<span style="color:#777">/**
 * Checks constructor with object
 */</span>
template&lt;&gt;
template&lt;&gt;
<span style="color:#088;font-weight:bold">void</span> object::test&lt;<span style="color:#00D">2</span>&gt;()
{
    {
        auto_ptr&lt;existing&gt; ap(new existing(exists));
        ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">get</span><span style="color:#710">&quot;</span></span>, ap.get() != <span style="color:#00D">0</span>);
        ensure_equals(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">constructed</span><span style="color:#710">&quot;</span></span>, exists, <span style="color:#069">true</span>);
    }
    <span style="color:#777">// ptr left scope</span>
    ensure_equals(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">destructed</span><span style="color:#710">&quot;</span></span>, exists, <span style="color:#069">false</span>);
}

<span style="color:#777">/**
 * Checks operator -&gt; and get()
 */</span>
template&lt;&gt;
template&lt;&gt;
<span style="color:#088;font-weight:bold">void</span> object::test&lt;<span style="color:#00D">3</span>&gt;()
{
    auto_ptr&lt;existing&gt; ap(new existing(exists));
    existing* p1 = ap.get();
    existing* p2 = ap.operator-&gt;();
    ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">get equiv -&gt;</span><span style="color:#710">&quot;</span></span>, p1 == p2);
    <span style="color:#777">// ensure no losing ownership</span>
    p1 = ap.get();
    ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">still owner</span><span style="color:#710">&quot;</span></span>, p1 == p2);
}

<span style="color:#777">/**
 * Checks release()
 */</span>
template&lt;&gt;
template&lt;&gt;
<span style="color:#088;font-weight:bold">void</span> object::test&lt;<span style="color:#00D">4</span>&gt;()
{
    {
        auto_ptr&lt;existing&gt; ap(new existing(exists));
        existing* p1 = ap.get();
        auto_ptr&lt;existing&gt; ap2(ap.release());
        ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">same pointer</span><span style="color:#710">&quot;</span></span>, p1 == ap2.get());
        ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">lost ownership</span><span style="color:#710">&quot;</span></span>, ap.get() == <span style="color:#00D">0</span>);
    }
    ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">destructed</span><span style="color:#710">&quot;</span></span>, exists == <span style="color:#069">false</span>);
}

<span style="color:#777">/**
 * Checks assignment.
 */</span>
template&lt;&gt;
template&lt;&gt;
<span style="color:#088;font-weight:bold">void</span> object::test&lt;<span style="color:#00D">5</span>&gt;()
{
    {
        auto_ptr&lt;existing&gt; ap(new existing(exists));
        existing* p1 = ap.get();
        auto_ptr&lt;existing&gt; ap2;
        ap2 = ap;
        ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">same pointer</span><span style="color:#710">&quot;</span></span>, p1 == ap2.get());
        ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">lost ownership</span><span style="color:#710">&quot;</span></span>, ap.get() == <span style="color:#00D">0</span>);
    }
    ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">destructed</span><span style="color:#710">&quot;</span></span>, exists == <span style="color:#069">false</span>);
}

<span style="color:#777">/**
 * Checks copy constructor.
 */</span>
template&lt;&gt;
template&lt;&gt;
<span style="color:#088;font-weight:bold">void</span> object::test&lt;<span style="color:#00D">6</span>&gt;()
{
    {
        auto_ptr&lt;existing&gt; ap(new existing(exists));
        existing* p1 = ap.get();
        auto_ptr&lt;existing&gt; ap2(ap);
        ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">same pointer</span><span style="color:#710">&quot;</span></span>, p1 == ap2.get());
        ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">lost ownership</span><span style="color:#710">&quot;</span></span>, ap.get() == <span style="color:#00D">0</span>);
    }
    ensure(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">destructed</span><span style="color:#710">&quot;</span></span>, exists == <span style="color:#069">false</span>);
}

}


</pre></div>
</div>


    </div>

    <div id="footer">

        <h1>
            <span>last change: 2013-12-18 11:19:40 +0100</span>
            <a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml11" alt="Valid XHTML 1.1" height="31" width="88" /></a>
            generated by <a href="http://webgen.gettalong.org">webgen</a>
        </h1>
    </div>
  </body>
</html>

<!--
    vim:ft=xhtml
 -->
